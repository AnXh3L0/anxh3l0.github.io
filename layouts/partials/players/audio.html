{{ $videoID := .video_id }}
{{ $uniqueID := printf "audio-%s" (substr (md5 $videoID) 0 8) }}
<figure class="audio-player-container relative" 
        data-platform="audio" 
        data-video-id="{{ $videoID }}"
        data-loaded="false"
        role="region" 
        aria-labelledby="{{ $uniqueID }}-title">
  
  {{/* Thumbnail button - shown before play */}}
  <button class="thumbnail-button relative flex h-20 w-full items-center gap-4 rounded-xl bg-zinc-100 p-4 transition-all hover:bg-zinc-200 dark:bg-zinc-800 dark:hover:bg-zinc-700" 
          data-timestamp="{{ .timestamp | default "0" }}"
          aria-label="{{ i18n "play_audio" }}: {{ .title }}">
    <div class="relative h-12 w-12 shrink-0 overflow-hidden rounded-lg bg-zinc-200 dark:bg-zinc-700">
      <img class="h-full w-full object-cover" 
           src="/media/images/thumbs/{{ .thumb | relURL }}" 
           alt=""
           aria-hidden="true"
           loading="lazy" 
           decoding="async"
           width="48" 
           height="48">
    </div>
    <div class="flex flex-1 items-center justify-between text-left">
      <div>
        <span class="block text-sm font-medium text-zinc-900 dark:text-zinc-100">{{ .title }}</span>
        <span class="block text-xs text-zinc-500 dark:text-zinc-400">{{ .event }}</span>
      </div>
      <span class="flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-teal-500 text-white shadow-lg transition-transform hover:scale-110" aria-hidden="true">
        <svg class="h-4 w-4 translate-x-0.5" fill="currentColor" viewBox="0 0 24 24">
          <path d="M8 5v14l11-7z"/>
        </svg>
      </span>
    </div>
  </button>

  {{/* Custom audio player - shown after clicking thumbnail */}}
  {{/* Map extension to proper MIME type */}}
  {{ $ext := .ext | default "mp3" }}
  {{ $mimeType := "audio/mpeg" }}
  {{ if eq $ext "m4a" }}{{ $mimeType = "audio/mp4" }}{{ end }}
  {{ if eq $ext "ogg" }}{{ $mimeType = "audio/ogg" }}{{ end }}
  {{ if eq $ext "wav" }}{{ $mimeType = "audio/wav" }}{{ end }}
  {{ if eq $ext "webm" }}{{ $mimeType = "audio/webm" }}{{ end }}
  <div class="custom-audio-player hidden rounded-xl bg-zinc-100 p-4 dark:bg-zinc-800" data-player-id="{{ $uniqueID }}">
    <audio class="audio-element" preload="metadata">
      <source src="/{{ $videoID }}" type="{{ $mimeType }}">
    </audio>
    
    {{/* Top row: Album art + info + controls */}}
    <div class="flex items-center gap-3 mb-3">
      {{/* Album art */}}
      <div class="relative h-12 w-12 shrink-0 overflow-hidden rounded-lg bg-zinc-200 dark:bg-zinc-700">
        <img class="h-full w-full object-cover" 
             src="/media/images/thumbs/{{ .thumb | relURL }}" 
             alt=""
             aria-hidden="true"
             width="48" 
             height="48">
      </div>
      
      {{/* Title + event */}}
      <div class="flex-1 min-w-0">
        <span class="block truncate text-sm font-medium text-zinc-900 dark:text-zinc-100">{{ .title }}</span>
        <span class="block text-xs text-zinc-500 dark:text-zinc-400">{{ .event }}</span>
      </div>
      
      {{/* Speed control */}}
      <button class="speed-btn shrink-0 rounded-md bg-zinc-200 px-2 py-1 text-xs font-medium text-zinc-700 hover:bg-zinc-300 dark:bg-zinc-700 dark:text-zinc-300 dark:hover:bg-zinc-600" aria-label="Playback speed">
        1x
      </button>
      
      {{/* Volume control */}}
      <div class="flex shrink-0 items-center gap-1">
        <button class="volume-btn flex h-7 w-7 items-center justify-center text-zinc-600 hover:text-zinc-900 dark:text-zinc-400 dark:hover:text-zinc-100" aria-label="Mute">
          <svg class="volume-high-icon h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"/>
          </svg>
          <svg class="volume-low-icon hidden h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15.536 8.464a5 5 0 010 7.072M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"/>
          </svg>
          <svg class="muted-icon hidden h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"/>
          </svg>
        </button>
        <input type="range" class="volume-slider h-1 w-16 cursor-pointer" min="0" max="1" step="0.05" value="1" aria-label="Volume">
      </div>
    </div>
    
    {{/* Bottom row: Play + progress */}}
    <div class="flex items-center gap-3">
      {{/* Play/Pause button */}}
      <button class="play-pause-btn flex h-9 w-9 shrink-0 items-center justify-center rounded-full bg-teal-500 text-white transition-colors hover:bg-teal-600" aria-label="Play">
        <svg class="play-icon h-4 w-4" fill="currentColor" viewBox="0 0 24 24">
          <path d="M8 5v14l11-7z"/>
        </svg>
        <svg class="pause-icon hidden h-4 w-4" fill="currentColor" viewBox="0 0 24 24">
          <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>
        </svg>
      </button>
      
      {{/* Current time */}}
      <span class="current-time w-10 text-xs tabular-nums text-zinc-600 dark:text-zinc-400">0:00</span>
      
      {{/* Progress bar */}}
      <div class="progress-container relative h-2 flex-1 cursor-pointer rounded-full bg-zinc-300 dark:bg-zinc-600" style="touch-action: none;">
        <div class="progress-bar absolute left-0 top-0 h-full rounded-full bg-teal-500" style="width: 0%"></div>
        <div class="progress-handle absolute top-1/2 h-3.5 w-3.5 -translate-x-1/2 -translate-y-1/2 rounded-full bg-teal-500 opacity-0 shadow-md transition-opacity sm:opacity-0 max-sm:opacity-100" style="left: 0%"></div>
      </div>
      
      {{/* Duration */}}
      <span class="duration w-10 text-xs tabular-nums text-zinc-600 dark:text-zinc-400">0:00</span>
    </div>
  </div>

  <figcaption id="{{ $uniqueID }}-title" class="sr-only">
    {{ .title }} ({{ .event }}, {{ dateFormat "2 January 2006" .date }})
  </figcaption>
</figure>
